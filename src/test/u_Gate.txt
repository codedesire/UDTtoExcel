TYPE "u_Gate"
//KNOW_HOW_PROTECT
AUTHOR : 'P@'
VERSION : 0.1


  STRUCT
   Time_Acum_Drift : DINT ;	//Накопитель времени для контроля съезда "Задвижки" (msec)
   CMD : INT ;	//Команды задвижки
   Time_Acum_Shift : DINT ;	//Накопитель времени для контроля перемещения "Задвижки" (msec)
   tmShift : INT  := 60;	//Время перемещения задвижки до крайнего положения (секунды)
   tmDrift : INT  := 5;	//Время съезда задвижки из крайнего положения (секунды)
   Time_Acum_Start_Stop : DINT ;	//Накопитель времени для контроля положения "Пускателя" (msec)
   STATUS : STRUCT 	//СОСТОЯНИЯ
    Undefine : BOOL ;	//Состояние: "Неопределённое"
    OFF : BOOL ;	//Состояние: "Остановлена"
    Ready_Remote_Fault : BOOL ;	//Состояние: "НЕ-Готов для ДИСТанционного режима"
    Ready_Remote_OK : BOOL ;	//Состояние: "Готов для ДИСТанционного режима"
    Alarm : BOOL ;	//Состояние: "АВАРИЯ Задвижки"
    Inhibit : BOOL ;	//Состояние: "ЗАПРЕТ на Запуск"
    OKEY : BOOL ;	//Состояние: "Всё в порядке" (технологические условия не учитываются)
    ON : BOOL ;	//Состояние: "Включена"
    Start_OP : BOOL ;	//Состояние: "Запускается (Открывание)"
    Start_CL : BOOL ;	//Состояние: "Запускается (Закрывание)"
    Run_OP : BOOL ;	//Состояние: "Работает (Открывание)"
    Run_CL : BOOL ;	//Состояние: "Работает (Закрывание)"
    Starter_ON : BOOL ;	//Состояние: "Пускатель поджат"
    Stoping : BOOL ;	//Состояние: "Останавливается"
    Ready_RepLoc_Fault : BOOL ;	//Состояние: "НЕ-Готов для МЕСТного режима"
    Ready_RepLoc_OK : BOOL ;	//Состояние: "Готов для МЕСТного режима"
    Local : BOOL ;	//Состояние: Режим работы "Местный - Сблокированый"
    _21 : BOOL ;
    _22 : BOOL ;
    _23 : BOOL ;
    _24 : BOOL ;
    _25 : BOOL ;
    _26 : BOOL ;
    _27 : BOOL ;
    Remote : BOOL ;	//Состояние: Режим работы "Дистанционный"
    Manual : BOOL ;	//Состояние: Режим работы "Дистанционный - Ручной"
    Auto : BOOL ;	//Состояние: Режим работы "Дистанционный - Автоматический"
    MP377 : BOOL ;	//Состояние: Режим работы "Дистанционный - Ручной" (MP377)
    WinCC : BOOL ;	//Состояние: Режим работы "Дистанционный - Ручной" (WinCC)
    Pos_OP : BOOL ;	//Состояние: Положение "Открыта"
    Pos_CL : BOOL ;	//Состояние: Положение "Закрыта"
    Repair : BOOL ;	//Состояние: Режим работы "Местный - Ремонтный"
   END_STRUCT ;
   MODE : STRUCT 	//РЕЖИМЫ
    POWER : BOOL ;	//Электропитание Шкафа (ВКЛЮЧЕНО)
    ENGINE_Run_1 : BOOL ;	//Технология "Работа" (1) > Пред. Агрегат (В РАБОТЕ)
    ENGINE_Run_2 : BOOL ;	//Технология "Работа" (2) > Пред. Агрегат (В РАБОТЕ)
    ENGINE_Start_1 : BOOL ;	//Технология "Запуск" (1) > Пред. Агрегат (В РАБОТЕ)
    ENGINE_Start_2 : BOOL ;	//Технология "Запуск" (2) > Пред. Агрегат (В РАБОТЕ)
    _05 : BOOL ;
    Repair_Local_PLC : BOOL ;	//Режим: Любое "Местное" Управление через КОНТРОЛЛЕР
    _07 : BOOL ;
    _10 : BOOL ;
    _11 : BOOL ;
    _12 : BOOL ;
    _13 : BOOL ;
    _14 : BOOL ;
    _15 : BOOL ;
    _16 : BOOL ;
    _17 : BOOL ;
   END_STRUCT ;
   _240 : WORD ;
   ALARM : STRUCT 	//АВАРИИ
    NET_CHECK : BOOL ;	//Авария: Отсутствует связь по Сети ProFiBus DP
    REMOTE : BOOL ;	//Авария: Дистанционное Управление
    SF : BOOL ;	//Авария: АВ Питания Задвижки
    QF : BOOL ;	//Авария: АВ Цепей Управления Задвижкой
    ON : BOOL ;	//Авария: Не пришло подтверждение Запуска
    OFF : BOOL ;	//Авария: Не пришло подтверждение Останова
    FAULT_STOP : BOOL ;	//Авария: Отключение Задвижки без команды
    _07 : BOOL ;
    SA : BOOL ;	//Авария: Аварийный Выключатель (грибок)
    _11 : BOOL ;
    _12 : BOOL ;
    _13 : BOOL ;
    _14 : BOOL ;
    _15 : BOOL ;
    _16 : BOOL ;
    _17 : BOOL ;
    _20 : BOOL ;
    _21 : BOOL ;
    _22 : BOOL ;
    _23 : BOOL ;
    _24 : BOOL ;
    _25 : BOOL ;
    OPEN : BOOL ;	//Авария: Нет положения "Открытия"
    CLOSE : BOOL ;	//Авария: Нет положения "Закрытия"
    OPEN_CLOSE : BOOL ;	//Авария: Одновременное "Открытие" и "Закрытие"
    DRIFT_OPEN : BOOL ;	//Авария: Нет движения в сторону "Открытия"
    DRIFT_CLOSE : BOOL ;	//Авария: Нет движения в сторону "Закрытия"
    _33 : BOOL ;
    _34 : BOOL ;
    _35 : BOOL ;
    _36 : BOOL ;
    Power : BOOL ;	//Авария: Отсутствует Электропитание Шкафа
   END_STRUCT ;
   INHIBIT : STRUCT 	//ЗАПРЕТЫ на "Запуск"
    NET_CHECK : BOOL ;	//Запрет: Отсутствует связь по Сети ProFiBus DP
    ENGINE_Run_1 : BOOL ;	//Запрет: Технология "Работа" (1) > Пред. Агрегат
    SF : BOOL ;	//Запрет: Отключен АВ Питания Задвижки
    QF : BOOL ;	//Запрет: Отключен АВ Цепей Управления Задвижкой
    FAULT_RUN : BOOL ;	//Запрет: Самопроизвольное Включение Задвижки
    OPEN_CLOSE : BOOL ;	//Запрет: Одновременное "Открытие" и "Закрытие"
    _06 : BOOL ;
    _07 : BOOL ;
    SA : BOOL ;	//Запрет: Аварийный Выключатель (грибок)
    _11 : BOOL ;
    _12 : BOOL ;
    _13 : BOOL ;
    _14 : BOOL ;
    _15 : BOOL ;
    _16 : BOOL ;
    Power : BOOL ;	//Запрет: Отсутствует Электропитание Шкафа
    _20 : BOOL ;
    _21 : BOOL ;
    _22 : BOOL ;
    _23 : BOOL ;
    _24 : BOOL ;
    _25 : BOOL ;
    ENGINE_Start_1 : BOOL ;	//Запрет: Технология "Запуск" (1) > Пред. Агрегат
    ENGINE_Run_2 : BOOL ;	//Запрет: Технология "Работа" (2) > Пред. Агрегат
    ENGINE_Start_2 : BOOL ;	//Запрет: Технология "Запуск" (2) > Пред. Агрегат
    _31 : BOOL ;
    _32 : BOOL ;
    _33 : BOOL ;
    _34 : BOOL ;
    _35 : BOOL ;
    _36 : BOOL ;
    _37 : BOOL ;
   END_STRUCT ;
   IN : STRUCT 	//ВХОДА задвижки
    SF_ON : BOOL ;	//АВ Питания Задвижки (включен)
    SF_ALARM : BOOL ;	//АВ Питания Задвижки (авария)
    QF_ON : BOOL ;	//АВ Цепей Управления Задвижкой (включен)
    QF_ALARM : BOOL ;	//АВ Цепей Управления Задвижкой (авария)
    SA : BOOL ;	//Аварийный Выключатель (НАЖАТ)
    _05 : BOOL ;
    _06 : BOOL ;
    _07 : BOOL ;
    _10 : BOOL ;
    _11 : BOOL ;
    _12 : BOOL ;
    _13 : BOOL ;
    _14 : BOOL ;
    _15 : BOOL ;
    _16 : BOOL ;
    _17 : BOOL ;
    LCB_Remote : BOOL ;	//Преключатель "Дистанционный" режим
    LCB_Repair : BOOL ;	//Преключатель "Местный - Ремонтный" режим
    LCB_Run_OP : BOOL ;	//Кнопка "ОТКРЫТЬ" (НО)
    LCB_Run_CL : BOOL ;	//Кнопка "ЗАКРЫТЬ" (НО)
    LCB_Stop : BOOL ;	//Кнопка "СТОП" (НЗ)
    LCB_Local : BOOL ;	//Переключатель "Местный - Сблокированый" режим
    _26 : BOOL ;
    _27 : BOOL ;
    Run_OP : BOOL ;	//Положение Пускателя (Открывание)
    Run_CL : BOOL ;	//Положение Пускателя (Закрывание)
    _32 : BOOL ;
    _33 : BOOL ;
    _34 : BOOL ;
    Pos_OP : BOOL ;	//Положение Задвижки (Открыто)
    Pos_CL : BOOL ;	//Положение Задвижки (Закрыто)
    NET_OK : BOOL ;	//Связь по сети ProFiBus DP (НОРМА)
   END_STRUCT ;
   BLK_OP : STRUCT 	//Блокировки ОПЕРАТОРА
    ENGINE_Run_2 : BOOL ;	//Блокировка: Технология "Работа" (2) > Пред. Агрегат
    ENGINE_Run_1 : BOOL ;	//Блокировка: Технология "Работа" (1) > Пред. Агрегат
    SF : BOOL ;	//Блокировка: АВ Питания Задвижки
    QF : BOOL ;	//Блокировка: АВ Цепей Управления Задвижкой
    RUN : BOOL ;	//Блокировка: Подтвеждение Работы / Останова
    ENGINE_Start_1 : BOOL ;	//Блокировка: Технология "Запуск" (1) > Пред. Агрегат
    _06 : BOOL ;
    _07 : BOOL ;
    SA : BOOL ;	//Блокировка: Аварийный Выключатель (грибок)
    _11 : BOOL ;
    _12 : BOOL ;
    _13 : BOOL ;
    _14 : BOOL ;
    _15 : BOOL ;
    _16 : BOOL ;
    ENGINE_Start_2 : BOOL ;	//Блокировка: Технология "Запуск" (2) > Пред. Агрегат
    _20 : BOOL ;
    _21 : BOOL ;
    _22 : BOOL ;
    _23 : BOOL ;
    _24 : BOOL ;
    _25 : BOOL ;
    _26 : BOOL ;
    _27 : BOOL ;
    _30 : BOOL ;
    _31 : BOOL ;
    _32 : BOOL ;
    _33 : BOOL ;
    _34 : BOOL ;
    _35 : BOOL ;
    _36 : BOOL ;
    _37 : BOOL ;
   END_STRUCT ;
   BLK_PR : STRUCT 	//Блокировки ПРОЕКТИРОВЩИКА
    ENGINE_Run_2 : BOOL ;	//Блокировка: Технология "Работа" (2) > Пред. Агрегат
    ENGINE_Run_1 : BOOL ;	//Блокировка: Технология "Работа" (1) > Пред. Агрегат
    SF : BOOL ;	//Блокировка: АВ Питания Задвижки
    QF : BOOL ;	//Блокировка: АВ Цепей Управления Задвижкой
    RUN : BOOL ;	//Блокировка: Подтвеждение Работы / Останова
    ENGINE_Start_1 : BOOL ;	//Блокировка: Технология "Запуск" (1) > Пред. Агрегат
    _06 : BOOL ;
    _07 : BOOL ;
    SA : BOOL ;	//Блокировка: Аварийный Выключатель (грибок)
    _11 : BOOL ;
    _12 : BOOL ;
    _13 : BOOL ;
    _14 : BOOL ;
    _15 : BOOL ;
    _16 : BOOL ;
    ENGINE_Start_2 : BOOL ;	//Блокировка: Технология "Запуск" (2) > Пред. Агрегат
    _20 : BOOL ;
    _21 : BOOL ;
    _22 : BOOL ;
    _23 : BOOL ;
    _24 : BOOL ;
    _25 : BOOL ;
    _26 : BOOL ;
    _27 : BOOL ;
    _30 : BOOL ;
    _31 : BOOL ;
    _32 : BOOL ;
    _33 : BOOL ;
    _34 : BOOL ;
    _35 : BOOL ;
    _36 : BOOL ;
    _37 : BOOL ;
   END_STRUCT ;
   PAR : STRUCT 	//ПАРАМЕТРЫ
    RUN_Hour : DINT ;	//Время работы задвижки (часы)
    START_Amount : INT ;	//Количество пусков задвижки
    ALARM_Amount : INT ;	//Количество аварийных отключений задвижки
    RUN_Minute : INT ;	//Время работы задвижки (минуты)
    BitMem : STRUCT
     FP_Run : BOOL ;
     FP_Alarm : BOOL ;
     FP_Second : BOOL ;
     _03 : BOOL ;
     _04 : BOOL ;
     _05 : BOOL ;
     _06 : BOOL ;
     _07 : BOOL ;
     Remote_1 : BOOL ;
     Remote_2 : BOOL ;
     Remote_3 : BOOL ;
     _11 : BOOL ;
     _12 : BOOL ;
     _13 : BOOL ;
     _14 : BOOL ;
     _15 : BOOL ;
    END_STRUCT ;
    tmStart : INT  := 1;	//Время включения пускателя задвижки (секунды)
    tmStop : INT  := 1;	//Время отключения пускателя задвижки (секунды)
    RUN_Second : INT ;	//Время работы задвижки (секунды)
    LastCMD : INT ;	//Последняя команда
    LastALM : INT ;	//Последняя авария
   END_STRUCT ;
  END_STRUCT ;
END_TYPE
