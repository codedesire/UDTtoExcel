TYPE "u_Motor"
//KNOW_HOW_PROTECT
AUTHOR : 'P@'
VERSION : 0.1


  STRUCT 	
   TYP : INT ;	
   NUM : INT ;	//Номер мотора
   CMD : INT ;	//Команды мотора
   PRM : DWORD ;	
   STA : INT ;	
   MOD : INT ;	
   Time_Acum_Start_Stop : DINT ;	//Накопитель времени для контроля положения пускателя (msec)
   STATUS : STRUCT 	//СОСТОЯНИЯ
    Undefine : BOOL ;	//Состояние: "Неопределённое"
    OFF : BOOL ;	//Состояние: "Остановлен"
    Ready_Remote_Fault : BOOL ;	//Состояние: "НЕ-Готов для ДИСТанционного режима"
    Ready_Remote_OK : BOOL ;	//Состояние: "Готов для ДИСТанционного режима"
    Alarm : BOOL ;	//Состояние: "АВАРИЙНЫЙ Останов"
    Inhibit : BOOL ;	//Состояние: "ЗАПРЕТ на Запуск"
    OKEY : BOOL ;	//Состояние: "Всё в порядке" (технологические остановы не учитываются)
    ON : BOOL ;	//Состояние: "Включен"
    Start_F : BOOL ;	//Состояние: "Запускается (Вперёд)"
    Start_B : BOOL ;	//Состояние: "Запускается (Назад)"
    Run_F : BOOL ;	//Состояние: "Работает (Вперёд)"
    Run_B : BOOL ;	//Состояние: "Работает (Назад)"
    Starter_ON : BOOL ;	//Состояние: "Пускатель поджат"
    Stoping : BOOL ;	//Состояние: "Останавливается"
    Ready_RepLoc_Fault : BOOL ;	//Состояние: "НЕ-Готов для МЕСТного режима"
    Ready_RepLoc_OK : BOOL ;	//Состояние: "Готов для МЕСТного режима"
    Local : BOOL ;	//Состояние: Режим работы "Местный - Сблокированый"
    _21 : BOOL ;	
    _22 : BOOL ;	
    _23 : BOOL ;	
    _24 : BOOL ;	
    _25 : BOOL ;	
    _26 : BOOL ;	
    _27 : BOOL ;	
    Remote : BOOL ;	//Состояние: Режим работы "Дистанционный"
    Manual : BOOL ;	//Состояние: Режим работы "Дистанционный - Ручной"
    Auto : BOOL ;	//Состояние: Режим работы "Дистанционный - Автоматический"
    MP377 : BOOL ;	//Состояние: Режим работы "Дистанционный - Ручной" (MP377)
    WinCC : BOOL ;	//Состояние: Режим работы "Дистанционный - Ручной" (WinCC)
    _35 : BOOL ;	
    _36 : BOOL ;	
    Repair : BOOL ;	//Состояние: Режим работы "Местный - Ремонтный"
   END_STRUCT ;	
   MODE : STRUCT 	//РЕЖИМЫ
    POWER : BOOL ;	//Электропитание Шкафа (ВКЛЮЧЕНО)
    ENGINE_Run_1 : BOOL ;	//Технология "Работа" (1) > Пред. Агрегат (В РАБОТЕ)
    ENGINE_Run_2 : BOOL ;	//Технология "Работа" (2) > Пред. Агрегат (В РАБОТЕ)
    ENGINE_Start_1 : BOOL ;	//Технология "Запуск" (1) > ПП-Сигнализация (ПОДГОТОВЛЕНА)
    ENGINE_Start_2 : BOOL ;	//Технология "Запуск" (2) > Пред. Агрегат (В РАБОТЕ)
    COMAND_Reset : BOOL ;	//Команда: Сброс Аварий
    Repair_Local_PLC : BOOL ;	//Режим: Любое "Местное" Управление через КОНТРОЛЛЕР
    COMAND_Statistic : BOOL ;	//Команда: Обнуление Статистики
    CDA_Enable : BOOL ;	//Режим: ПП-Сигнализациия (Применять при Запуске)
    CDA_End : BOOL ;	//ПП-Сигнализациия (ОТЗВЕНЕЛА)
    COMAND_Start_MP377 : BOOL ;	//Команда: ВКЛючение с Панели MP377
    COMAND_Stop_MP377 : BOOL ;	//Команда: ОТКЛючение с Панели MP377
    COMAND_Start_WinCC : BOOL ;	//Команда: ВКЛючение со Станции WinCC
    COMAND_Stop_WinCC : BOOL ;	//Команда: ОТКЛючение со Станции WinCC
    COMAND_Start_AUTO : BOOL ;	//Команда: ВКЛючение в АВТОматическом режиме
    COMAND_Stop_AUTO : BOOL ;	//Команда: ОТКЛючение в АВТОматическом режиме
   END_STRUCT ;	
   Empty_WORD : WORD ;	
   ALARM : STRUCT 	//АВАРИИ
    NET_CHECK : BOOL ;	//Авария: Отсутствует связь по Сети ProFiBus DP
    REMOTE : BOOL ;	//Авария: Дистанционное Управление
    SF : BOOL ;	//Авария: Отключился АВ Питания двигателя
    QF : BOOL ;	//Авария: Отключился АВ Цепей Управления двигателем
    ON : BOOL ;	//Авария: Не пришло подтверждение Запуска
    OFF : BOOL ;	//Авария: Не пришло подтверждение Останова
    FAULT_STOP : BOOL ;	//Авария: Отключение Двигателя без команды
    DRV : BOOL ;	//Авария: Готовность Привода
    SA : BOOL ;	//Авария: Принудительный Аварийный Останов (грибок)
    SAFE : BOOL ;	//Авария: Защита Конвейра
    ROTATE : BOOL ;	//Авария: Вращение Конвейера
    STREAM : BOOL ;	//Авария: Забивка Течки
    BEAR : BOOL ;	//Авария: Температура Подшипников
    Oil_Flow : BOOL ;	//Авария: Проток Масла
    Oil_Pressure : BOOL ;	//Авария: Давление Масла
    WIND : BOOL ;	//Авария: Температура Обмоток
    Water_Flow : BOOL ;	//Авария: Проток Воды
    Water_Pressure : BOOL ;	//Авария: Давление Воды
    Motor_1 : BOOL ;	//Авария: Двигатель - 1
    Motor_2 : BOOL ;	//Авария: Двигатель - 2
    Motor_3 : BOOL ;	//Авария: Двигатель - 3
    LOCKEL : BOOL ;	//Авария: Электрические Блокировки Разобраны
    BELT : BOOL ;	//Авария: Положение Ленты
    Power : BOOL ;	//Авария: Отсутствует Электропитание Шкафа
    _30 : BOOL ;	
    _31 : BOOL ;	
    _32 : BOOL ;	
    _33 : BOOL ;	
    _34 : BOOL ;	
    _35 : BOOL ;	
    _36 : BOOL ;	
    _37 : BOOL ;	
   END_STRUCT ;	
   INHIBIT : STRUCT 	//ЗАПРЕТЫ на "Запуск"
    NET_CHECK : BOOL ;	//Запрет: Отсутствует связь по Сети ProFiBus DP
    ENGINE_Run_1 : BOOL ;	//Запрет: Технология "Работа" (1) > Пред. Агрегат
    SF : BOOL ;	//Запрет: Отключен АВ Питания двигателя
    QF : BOOL ;	//Запрет: Отключен АВ Цепей Управления двигателем
    FAULT_RUN : BOOL ;	//Запрет: Самопроизвольное Включение Двигателя
    BELT : BOOL ;	//Запрет: Положение Ленты
    WIND : BOOL ;	//Запрет: Высокая Температура Обмоток
    DRV : BOOL ;	//Запрет: Отсутствует Готовность Привода
    SA : BOOL ;	//Запрет: Нажат Выключатель Экстренного Останова (грибок)
    SAFE : BOOL ;	//Запрет: Сработали защиты конвейра
    ROTATE : BOOL ;	//Запрет: Отсутствует Вращение Конвейера
    STREAM : BOOL ;	//Запрет: Забивка Течки
    BEAR : BOOL ;	//Запрет: Высокая Температура Подшипников
    Oil_Flow : BOOL ;	//Запрет: Отсутствует Проток Масла
    Oil_Pressure : BOOL ;	//Запрет: Отсутствует Давление Масла
    Power : BOOL ;	//Запрет: Отсутствует Электропитание Шкафа
    Water_Flow : BOOL ;	//Запрет: Отсутствует Проток Воды
    Water_Pressure : BOOL ;	//Запрет: Отсутствует Давление Воды
    Motor_1 : BOOL ;	//Запрет: Двигатель - 1 (аварийное состояние)
    Motor_2 : BOOL ;	//Запрет: Двигатель - 2 (аварийное состояние)
    Motor_3 : BOOL ;	//Запрет: Двигатель - 3 (аварийное состояние)
    LOCKEL : BOOL ;	//Запрет: Электрические Блокировки Разобраны
    ENGINE_Start_1 : BOOL ;	//Запрет: Технология "Запуск" (1) > ПП-Сигнализация
    ENGINE_Run_2 : BOOL ;	//Запрет: Технология "Работа" (2) > Пред. Агрегат
    ENGINE_Start_2 : BOOL ;	//Запрет: Технология "Запуск" (2) > Пред. Агрегат
    _31 : BOOL ;	
    _32 : BOOL ;	
    _33 : BOOL ;	
    _34 : BOOL ;	
    _35 : BOOL ;	
    _36 : BOOL ;	
    _37 : BOOL ;	
   END_STRUCT ;	
   IN : STRUCT 	//ВХОДА Мотора
    SF_ON : BOOL ;	//АВ Питания двигателя (включен)
    SF_ALARM : BOOL ;	//АВ Питания двигателя (авария)
    QF_ON : BOOL ;	//АВ Цепей Управления двигателем (включен)
    QF_ALARM : BOOL ;	//АВ Цепей Управления двигателем (авария)
    SA : BOOL ;	//Аварийный Выключатель (НАЖАТ)
    SAFE : BOOL ;	//Защита Конвейера (НАРУШЕНА)
    WIND : BOOL ;	//Температура Обмоток (НОРМА)
    ROTATE : BOOL ;	//Вращение Конвейера (НЕ КРУТИТСЯ)
    STREAM : BOOL ;	//Забивка Течки (ЗАБИТА)
    BEAR : BOOL ;	//Температура Подшипников (НОРМА)
    DRV : BOOL ;	//Готовность Привода (ПРИСУТСТВУЕТ)
    Oil_Flow : BOOL ;	//Проток масла (ПРИСУТСТВУЕТ)
    Oil_Pressure : BOOL ;	//Давление масла (ПРИСУТСТВУЕТ)
    Water_Flow : BOOL ;	//Проток Воды (ПРИСУТСТВУЕТ)
    Second : BOOL ;	//Входной секундный импульс
    Water_Pressure : BOOL ;	//Давление Воды (ПРИСУТСТВУЕТ)
    LCB_Remote : BOOL ;	//Преключатель "Дистанционный"
    LCB_Repair : BOOL ;	//Преключатель "Местный - Ремонтный"
    LCB_Run_F : BOOL ;	//Кнопка "Включить (Вперёд)" (НО)
    LCB_Run_B : BOOL ;	//Кнопка "Включить (Назад)" (НО)
    LCB_Stop : BOOL ;	//Кнопка "Стоп" (НЗ)
    LCB_Local : BOOL ;	//Переключатель "Местный - Сблокированый"
    Motor_1 : BOOL ;	//Мотор - 1 (НОРМА)
    BELT : BOOL ;	//Положение Ленты (НОРМА)
    Run_F : BOOL ;	//Положение Пускателя (Вперёд)
    Run_B : BOOL ;	//Положение Пускателя (Назад)
    Motor_2 : BOOL ;	//Мотор - 2 (НОРМА)
    Motor_3 : BOOL ;	//Мотор - 3 (НОРМА)
    LOCKEL : BOOL ;	//Электрические Блокировки Собраны
    DRV_Alarm : BOOL ;	//Авария Привода (ПРИСУТСТВУЕТ)
    _36 : BOOL ;	
    NET_OK : BOOL ;	//Связь по сети ProFiBus DP (НОРМА)
   END_STRUCT ;	
   BLK_OP : STRUCT 	//Блокировки ОПЕРАТОРА
    ENGINE_Run_2 : BOOL ;	//Блокировка: Технология "Работа" (2) > Пред. Агрегат
    ENGINE_Run_1 : BOOL ;	//Блокировка: Технология "Работа" (1) > Пред. Агрегат
    SF : BOOL ;	//Блокировка: АВ Питания двигателя
    QF : BOOL ;	//Блокировка: АВ Цепей Управления двигателем
    RUN : BOOL ;	//Блокировка: Подтвеждение Работы / Останова
    ENGINE_Start_1 : BOOL ;	//Блокировка: Технология "Запуск" (1) > ПП-Сигнализация
    WIND : BOOL ;	//Блокировка: Температура Обмоток
    DRV : BOOL ;	//Блокировка: Готовность Привода
    SA : BOOL ;	//Блокировка: Аварийный Выключатель (грибок)
    SAFE : BOOL ;	//Блокировка: Защита Конвейера
    ROTATE : BOOL ;	//Блокировка: Вращение Конвейера
    STREAM : BOOL ;	//Блокировка: Забивка Течки
    BEAR : BOOL ;	//Блокировка: Температура Подшипников
    Oil_Flow : BOOL ;	//Блокировка: Проток Масла
    Oil_Pressure : BOOL ;	//Блокировка: Давление Масла
    ENGINE_Start_2 : BOOL ;	//Блокировка: Технология "Запуск" (2) > Пред. Агрегат
    Water_Flow : BOOL ;	//Блокировка: Проток Воды
    Water_Pressure : BOOL ;	//Блокировка: Давление Воды
    Motor_1 : BOOL ;	//Блокировка: Мотор - 1
    Motor_2 : BOOL ;	//Блокировка: Мотор - 2
    Motor_3 : BOOL ;	//Блокировка: Мотор - 3
    LOCKEL : BOOL ;	//Блокировка: Электрические Блокировки Собраны
    BELT : BOOL ;	//Блокировка: Положение Ленты
    _27 : BOOL ;	
    _30 : BOOL ;	
    _31 : BOOL ;	
    _32 : BOOL ;	
    _33 : BOOL ;	
    _34 : BOOL ;	
    _35 : BOOL ;	
    _36 : BOOL ;	
    _37 : BOOL ;	
   END_STRUCT ;	
   BLK_PR : STRUCT 	//Блокировки ПРОЕКТИРОВЩИКА
    ENGINE_Run_2 : BOOL ;	//Блокировка: Технология "Работа" (2) > Пред. Агрегат
    ENGINE_Run_1 : BOOL ;	//Блокировка: Технология "Работа" (1) > Пред. Агрегат
    SF : BOOL ;	//Блокировка: АВ Питания двигателя
    QF : BOOL ;	//Блокировка: АВ Цепей Управления двигателем
    RUN : BOOL ;	//Блокировка: Подтвеждение Работы / Останова
    ENGINE_Start_1 : BOOL ;	//Блокировка: Технология "Запуск" (1) > ПП-Сигнализация
    WIND : BOOL ;	//Блокировка: Температура Обмоток
    DRV : BOOL ;	//Блокировка: Готовность Привода
    SA : BOOL ;	//Блокировка: Аварийный Выключатель (грибок)
    SAFE : BOOL ;	//Блокировка: Защита Конвейера
    ROTATE : BOOL ;	//Блокировка: Вращение Конвейера
    STREAM : BOOL ;	//Блокировка: Забивка Течки
    BEAR : BOOL ;	//Блокировка: Температура Подшипников
    Oil_Flow : BOOL ;	//Блокировка: Проток Масла
    Oil_Pressure : BOOL ;	//Блокировка: Давление Масла
    ENGINE_Start_2 : BOOL ;	//Блокировка: Технология "Запуск" (2) > Пред. Агрегат
    Water_Flow : BOOL ;	//Блокировка: Проток Воды
    Water_Pressure : BOOL ;	//Блокировка: Давление Воды
    Motor_1 : BOOL ;	//Блокировка: Мотор - 1
    Motor_2 : BOOL ;	//Блокировка: Мотор - 2
    Motor_3 : BOOL ;	//Блокировка: Мотор - 3
    LOCKEL : BOOL ;	//Блокировка: Электрические Блокировки Собраны
    BELT : BOOL ;	//Блокировка: Положение Ленты
    _27 : BOOL ;	
    _30 : BOOL ;	
    _31 : BOOL ;	
    _32 : BOOL ;	
    _33 : BOOL ;	
    _34 : BOOL ;	
    _35 : BOOL ;	
    _36 : BOOL ;	
    _37 : BOOL ;	
   END_STRUCT ;	
   PAR : STRUCT 	//ПАРАМЕТРЫ
    RUN_Hour : DINT ;	//Время работы мотора (часы)
    START_Amount : INT ;	//Количество пусков мотора
    ALARM_Amount : INT ;	//Количество аварийных отключений мотора
    RUN_Minute : INT ;	//Время работы мотора (минуты)
    BitMem : STRUCT 	
     FP_Run : BOOL ;	
     FP_Alarm : BOOL ;	
     FP_Second : BOOL ;	
     Reset_Strobe : BOOL ;	//Импульс Сброса
     _04 : BOOL ;	
     _05 : BOOL ;	
     _06 : BOOL ;	
     _07 : BOOL ;	
     Remote_1 : BOOL ;	
     Remote_2 : BOOL ;	
     Remote_3 : BOOL ;	
     _11 : BOOL ;	
     _12 : BOOL ;	
     _13 : BOOL ;	
     _14 : BOOL ;	
     _15 : BOOL ;	
    END_STRUCT ;	
    tmStart : INT  := 1;	//Время контроля включения пускателя (секунды)
    tmStop : INT  := 1;	//Время контроля отключения пускателя (секунды)
    RUN_Second : INT ;	//Время работы мотора (секунды)
    LastCMD : INT ;	//Последняя команда
    LastALM : INT ;	//Последняя авария
   END_STRUCT ;	
  END_STRUCT ;	
END_TYPE

